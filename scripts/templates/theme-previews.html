<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Theme Previews</title>
    <style>
        :root { --bg:#fff; --fg:#111; --muted:#667; --border:#e5e7eb; --card:#fff; }
        @media (prefers-color-scheme: dark){ :root { --bg:#0b0f16; --fg:#e6ecf1; --muted:#9aa6b2; --border:#253046; --card:#111827; } }
        body{font-family:system-ui, Segoe UI, Roboto, Arial; margin:20px; line-height:1.45; background:var(--bg); color:var(--fg)}
        h1{margin:0 0 12px}
        h2{margin:28px 0 8px}
        .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:12px; align-items:start}
        .card{margin:0; border:1px solid var(--border); border-radius:10px; overflow:hidden; background:var(--card)}
        .card-head{padding:8px 10px; font:12px/1.4 system-ui,Segoe UI,Roboto,Arial; background:color-mix(in srgb,var(--card) 94%, #f8fafc); border-bottom:1px solid var(--border); display:flex; gap:8px; align-items:center}
        .card img{display:block; width:100%; height:auto; cursor:zoom-in}
        .card a{color:inherit; text-decoration:underline; cursor:pointer}
        dialog#viewer{border:none; padding:0; border-radius:12px; max-width:min(96vw, 1200px); width:fit-content; background:var(--card); color:var(--fg)}
        dialog::backdrop{background:rgba(0,0,0,0.45)}
        .viewer-head{display:flex; align-items:center; gap:8px; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--border); font-weight:600}
        .viewer-body{max-height:80vh; overflow:auto}
        .viewer-body img{display:block; max-width:90vw; height:auto}
        .viewer-body pre{margin:0; padding:12px; white-space:pre-wrap; word-break:break-word; font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
        .btn{background:#2563eb; color:#fff; border:none; padding:6px 10px; border-radius:8px; cursor:pointer}
        .btn.secondary{background:transparent; color:var(--fg); border:1px solid var(--border)}
    </style>
</head>
<body>
<h1>Theme Previews</h1>
{{rows}}
<dialog id="viewer">
    <div class="viewer-head">
        <span id="viewer-title">Preview</span>
        <div style="display:flex; gap:8px; align-items:center">
            <button class="btn secondary" id="copy-btn" title="Copy text" hidden>Copy</button>
            <button class="btn secondary" data-close title="Close">Close</button>
        </div>
    </div>
    <div class="viewer-body" id="viewer-body"></div>
</dialog>
<script>
    (function(){
        const dlg = document.getElementById('viewer');
        const body = document.getElementById('viewer-body');
        const title = document.getElementById('viewer-title');
        const copyBtn = document.getElementById('copy-btn');

        function openWithImage(src, alt){
            body.innerHTML='';
            const img = new Image();
            img.src = src; img.alt = alt || '';
            body.appendChild(img);
            title.textContent = alt || 'Image';
            copyBtn.hidden = true;
            if (!dlg.open) dlg.showModal();
        }
        function openWithText(text, name){
            body.innerHTML='';
            const pre = document.createElement('pre');
            pre.textContent = text;
            body.appendChild(pre);
            title.textContent = name || 'Variables';
            copyBtn.hidden = false;
            copyBtn.onclick = function(){
                navigator.clipboard.writeText(text).catch(()=>{});
            };
            if (!dlg.open) dlg.showModal();
        }

        document.addEventListener('click', function(e){
            const close = e.target.closest('[data-close]');
            if (close && dlg.open) { dlg.close(); return; }
            const img = e.target.closest('img[data-view]');
            if (img){ e.preventDefault(); openWithImage(img.src, img.alt); return; }
            const varsLink = e.target.closest('a[data-vars]');
            if (varsLink){
                e.preventDefault();
                fetch(varsLink.getAttribute('href')).then(r=>r.text()).then(t=>openWithText(t, varsLink.getAttribute('href')));
                return;
            }
        });
        document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && dlg.open) dlg.close(); });
    })();
</script>
</body>
</html>
