{% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', '{{ site.google_analytics }}');
    </script>
{% endif %}

<!-- Theme toggle script (uses inline SVGs so it doesn't depend on external icon fonts) -->
<script>
(function() {
  const root = document.documentElement;
  function setTheme(mode) {
    if (mode === 'dark') {
      root.setAttribute('data-theme', 'dark');
    } else if (mode === 'light') {
      root.setAttribute('data-theme', 'light');
    } else {
      root.removeAttribute('data-theme');
    }
  }
  function getSystemTheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  function getSavedTheme() { return localStorage.getItem('theme'); }
  function saveTheme(mode) { if (mode) localStorage.setItem('theme', mode); else localStorage.removeItem('theme'); }

  function svgFor(name) {
    switch(name) {
      case 'moon':
        return '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M21 12.79A9 9 0 0111.21 3c.12 0 .24 0 .36.01A7 7 0 1021 12.79z" fill="currentColor"/></svg>';
      case 'sun':
        return '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 8h2v-3h-2v3zM17.24 4.84l1.79 1.79 1.79-1.79-1.8-1.79-1.78 1.79zM20 11v2h3v-2h-3zM4.22 19.78l1.79-1.79-1.79-1.79-1.79 1.79 1.79 1.79zM12 6a6 6 0 100 12 6 6 0 000-12zM19.78 19.78l1.79-1.79-1.79-1.79-1.79 1.79 1.79 1.79z" fill="currentColor"/></svg>';
      default:
        return '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M12 3v2M12 19v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    }
  }

  function updateIcons() {
    document.querySelectorAll('#theme-toggle-icon').forEach(function(icon){
      const cur = root.getAttribute('data-theme');
      if (cur === 'dark') { icon.innerHTML = svgFor('moon'); }
      else if (cur === 'light') { icon.innerHTML = svgFor('sun'); }
      else { icon.innerHTML = svgFor('half'); }
    });
  }

  function updateTheme() {
    const saved = getSavedTheme();
    setTheme(saved || null);
    updateIcons();
  }

  document.addEventListener('click', function(e){
    const t = e.target.closest && e.target.closest('#theme-toggle');
    if (!t) return;
    const current = root.getAttribute('data-theme');
    if (!current) {
      const sys = getSystemTheme();
      const next = (sys === 'dark' ? 'light' : 'dark');
      setTheme(next); saveTheme(next);
    } else if (current === 'dark') { setTheme('light'); saveTheme('light'); }
    else { setTheme(null); saveTheme(null); }
    updateIcons();
  });

  updateTheme();
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(){ updateTheme(); updateIcons(); });
})();
</script>
