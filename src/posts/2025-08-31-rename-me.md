---
layout: post
category: 
title: "rename me"
imagefeature:
description: 
draft: true
tags: ["Programming", "AI", "LLM"]
---
###

When I first heard about RAG (Retrieval Augmented Generation) in the context of large language models (LLMs), I was expecting it to be a complex and technical concept, even after doing a little bit of reading and discovering that the information generally was stored as embeddings in a vector database that there would be a fair amount of complexity involved.  But eventually I realized that RAG is really a very straightforward concept, you add (or augment) the prompt to the LLM with information that is relevant to the question being asked.  

It is as simple as supplying the prompt with the information required to answer the question and then using the power of the LLM to generate a human response that isn't just a regurgitation of the supplied information, but a synthesis of the information that is relevant to the question being asked.  

For the past 7 blog posts we have been using the recipes from the [Recipe Folder](https://web.archive.org/web/20220630230600/http://recipe-folder.com/) database to experiment with various aspects of Machine Learning.  We are going to do the same here, but this time use an LLM to help create a recipe suggestion system.  The idea is that the user will provide a list of ingredients they have on hand and the LLM will suggest a recipe that can be made with those ingredients.  The LLM will use RAG to augment the prompt with the recipes from the Recipe Folder database based on the ingredients provided by the user.

Lets use a Jupyter notebook to explore this idea.  First lets switch to the rag branch of the repository.

```bash
git checkout rag
```

and install the requirements for this blog post:

```bash
./.venv/Scripts/activate # Windows
# or
source ./.venv/bin/activate # Linux/MacOS
pip install -r requirements.txt
```

Now we can look at the notebook that we will be using to explore this idea.  Open the `rag.ipynb` file in Jupyter notebook.  You have to run the first cell, but it just imports the required libraries and sets up some paths.

```python
# Load a small pre-trained embedding model (open local model)
model = SentenceTransformer('all-MiniLM-L6-v2')  # open-source embedding model
```

First we load the SentenceTransformer model that we will be using to create the embeddings for the recipes.   The model is downloaded from the internet the first time it is run, so the first time it is run it will take a little time.

```python
# Ensure the labels directory exists
if not labels_dir.exists():
    print(f"Directory {labels_dir} does not exist. Please create it and add JSON files.")
    exit(1)

# Collect JSON files
files = sorted([p for p in labels_dir.iterdir() if p.is_file() and p.suffix == '.json'])

progress = widgets.IntProgress(value=0, min=0, max=len(files), description='Progress:')
pct = widgets.HTML(value="0%")
display(widgets.HBox([progress, pct]))
embedding_db = []  # list to store {"id", "name", "vector"} for each recipe
for idx, fp in enumerate(files):
    try:
        text = fp.read_text(encoding='utf-8')
        obj = json.loads(text)   
    except Exception as e:
        # Log and continue on parse/read errors
        print(f'Skipping {fp.name}: {e}')
        continue

    progress.value = idx + 1
    pct.value = f"{int(100 * (idx + 1) / len(files))}%"

    # add source filename so downstream steps know which file produced this record
    if isinstance(obj, dict) and obj.get("title") and obj.get("ingredients"):
        title_instructions_file = {
            
        }
        text = f"{obj["title"]}: " + ", ".join(obj["ingredients"])
        vector = model.encode(text)            # get embedding vector (e.g., numpy array)
        embedding_db.append({
            "title" : obj["title"],
            "ingredients": obj["ingredients"],
            "source_file": fp.name,
            "vector": vector
        })
        
progress.value = len(files)
pct.value = "100%"

pickle.dump(embedding_db, open(model_path, 'wb'))
print(f"Stored {len(embedding_db)} recipe embeddings in the database.")
```
